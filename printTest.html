
<!DOCTYPE html>
<html>
<head>
  <title>Leaflet browser print plugin with custom print Layer and content</title>
  <meta charset="utf-8"/>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@latest/dist/leaflet.css"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.css">
  <link rel="stylesheet" href="https://leaflet.github.io/Leaflet.markercluster/dist/MarkerCluster.css"/>
  <link rel="stylesheet" href="https://leaflet.github.io/Leaflet.markercluster/dist/MarkerCluster.Default.css"/>
  <style>
    html, body {
      width: 100%;
      height: 100%;
      margin: 0px;
      padding: 0px;
    }

    #map {
      width: 80%;
      margin: auto;
      height: 70%;
    }
  </style>
</head>

<body>
<h1 class="title" leaflet-browser-print-content>MCBBA Test Map</h1>
<h3 class="sub-content" leaflet-browser-print-content>Block number would be here.</h3>
<div id="map"></div>
<p>this is a test, this sentance shouldn't print.</p>
<script src="https://unpkg.com/leaflet@latest/dist/leaflet.js"></script>
<script src="https://leaflet.github.io/Leaflet.markercluster/dist/leaflet.markercluster-src.js"></script>
<script src="https://igor-vladyka.github.io/leaflet.browser.print/dist/leaflet.browser.print.js"></script>
<script src="https://leaflet.github.io/Leaflet.markercluster/example/realworld.388.js">

</script>
<script src="https://cdn.jsdelivr.net/npm/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.min.js"></script>
<script>
    var canvasRenderer = L.canvas();
    //Layers
    var cities = L.markerClusterGroup();
    var arrayOfPoints = [[39.61, -105.02], [39.73, -104.8], [39.77, -105.23]];

    L.marker(arrayOfPoints[0]).bindPopup('This is Littleton, CO.').addTo(cities);
    L.marker(arrayOfPoints[1]).bindPopup('This is Aurora, CO.').addTo(cities);
    L.marker(arrayOfPoints[2]).bindPopup('This is Golden, CO.').addTo(cities);

    var p = L.polygon(arrayOfPoints, {color: 'yellow'}).bindTooltip("polygon").bindPopup('This is Polygon, CO.').addTo(cities);

    var base = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    });
    var wms = L.tileLayer.wms('https://ahocevar.com/geoserver/wms', {
        layers: 'topp:states',
        CQL_FILTER: 'PERSONS > 2000000',
        styles: '',
        format: 'image/png',
        transparent: true,
    });

    var map = L.map('map', {
        center: [39.73, -104.99],
        zoom: 10,
        layers: [base, cities]
    });

    var baseLayers = {
        "Origin": base,
        "WMS": wms
    };

    var overlays = {
        "Cities": cities
    };

    L.control.layers(baseLayers, overlays).addTo(map);


    L.control.scale({position: 'topleft'}).addTo(map);

    map.pm.addControls({
        position: 'bottomright',
        editControls: false
    });
    var drawnItems = new L.FeatureGroup().addTo(map);
    map.on("pm:create", function (e) {
        var type = e.shape,
            layer = e.layer;

        if (type === 'Marker') {
            layer.bindPopup('A popup!');
        }

        drawnItems.addLayer(layer);
    });


    map.createPane("new-pane");
    var l = L.layerGroup().addTo(map);
    var green = L.circle([39.73, -104.99], 5000, {
        color: 'green',
        fillColor: 'darkgreen',
        fillOpacity: 0.8,
        pane: "new-pane",
        renderer: canvasRenderer
    }).addTo(l);


    var customActionToPrint = function (context, mode) {
        return function () {
            window.alert("We are printing the MAP. Let's do Custom print here!");
            context._printCustom(mode);
        }
    };

    L.control.browserPrint({
        printLayer:    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }),
        closePopupsOnPrint: false,
        printModes: [
            L.BrowserPrint.Mode.Landscape()
        ]
    }).addTo(map);

    L.BrowserPrint.Utils.registerLayer(L.TileLayer.WMS, 'L.TileLayer.WMS', function (layer) {
        console.info("Printing WMS layer.");
        return L.tileLayer.wms(layer._url, layer.options);
    });

    L.popup({minWidth: 500}).setLatLng(L.latLng(39.73, -104.99)).setContent("lat/long could be here").openOn(map);

    var markers = L.markerClusterGroup();

    for (var i = 0; i < addressPoints.length; i++) {
        var a = addressPoints[i];
        var title = a[2];
        var marker = L.marker(new L.LatLng(a[0], a[1]), {title: title});
        marker.bindPopup(title);
        markers.addLayer(marker);
    }
    map.addLayer(markers);

    // We are not cloning markercluster to preserve original clasterization behavior and prevent OutOfMemory problems
    L.BrowserPrint.Utils.registerLayer(L.MarkerClusterGroup, 'L.MarkerClusterGroup', function (layer, utils) {
        return layer;
    });

    // On print end we invalidate markercluster to update markers;
    map.on(L.BrowserPrint.Event.PrintEnd, function (e) {
        map.removeLayer(markers);
        map.addLayer(markers);
    });


</script>

<style>
  .grid-print-container {
    grid-template: auto 1fr auto / 1fr;
    background-color: white;
  }

  .grid-map-print {
    grid-row: 2;
  }

  .grid-print-container > .title,
  .grid-print-container > .sub-content {
    color: black;
  }

  .title {
    grid-row: 1;
    justify-self: center;
    text-align: center;
    color: grey;
    box-sizing: border-box;
    margin-top: 0;
  }

  .sub-content {
    grid-row: 5;
    padding-left: 10px;
    text-align: center;
    color: grey;
    box-sizing: border-box;
  }
</style>
<style>
  [leaflet-browser-print-pages] {
    display: none;
  }

  .pages-print-container [leaflet-browser-print-pages] {
    display: block;
  }
</style>
</body>

</html>
